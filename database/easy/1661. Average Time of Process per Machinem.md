## Schema
```
drop table if exists Activity
Create table Activity (machine_id int
, process_id int
, activity_type nvarchar(20) not null check (activity_type in ('start','end'))
, timestamp float)
insert into Activity (machine_id, process_id, activity_type, timestamp) values ('0', '0', 'start', '0.712')
insert into Activity (machine_id, process_id, activity_type, timestamp) values ('0', '0', 'end', '1.52')
insert into Activity (machine_id, process_id, activity_type, timestamp) values ('0', '1', 'start', '3.14')
insert into Activity (machine_id, process_id, activity_type, timestamp) values ('0', '1', 'end', '4.12')
insert into Activity (machine_id, process_id, activity_type, timestamp) values ('1', '0', 'start', '0.55')
insert into Activity (machine_id, process_id, activity_type, timestamp) values ('1', '0', 'end', '1.55')
insert into Activity (machine_id, process_id, activity_type, timestamp) values ('1', '1', 'start', '0.43')
insert into Activity (machine_id, process_id, activity_type, timestamp) values ('1', '1', 'end', '1.42')
insert into Activity (machine_id, process_id, activity_type, timestamp) values ('2', '0', 'start', '4.1')
insert into Activity (machine_id, process_id, activity_type, timestamp) values ('2', '0', 'end', '4.512')
insert into Activity (machine_id, process_id, activity_type, timestamp) values ('2', '1', 'start', '2.5')
insert into Activity (machine_id, process_id, activity_type, timestamp) values ('2', '1', 'end', '5')
```

## Question



## My Solution
```
with 
tbl_start as
(
select * 
from Activity
where activity_type = 'start'
),

tbl_end as
(
select * 
from Activity
where activity_type = 'end'
),

tbl_comb as
(
select s.machine_id
, s.process_id
, s.timestamp as start_time
, e.timestamp as end_time
, e.timestamp - s.timestamp as process_time
from tbl_start s
join tbl_end e
on  1=1
and s.machine_id = e.machine_id
and s.process_id = e.process_id
)

select
machine_id
, cast(avg(process_time) as decimal(6,3)) as processing_time
from tbl_comb
group by machine_id
```

## Chatgpt Solution

```
SELECT 
machine_id
, process_id
, activity_type
,CASE WHEN activity_type = 'end' THEN timestamp END AS end_time
,CASE WHEN activity_type = 'start' THEN timestamp END AS start_time
FROM Activity
```

<img width="369" height="253" alt="image" src="https://github.com/user-attachments/assets/0fe7c994-1cd9-47d7-a87d-0691daa2a8f2" />


```
SELECT 
machine_id
, process_id
, max(CASE WHEN activity_type = 'end' THEN timestamp END) AS end_time
, max(CASE WHEN activity_type = 'start' THEN timestamp END) AS start_time
FROM Activity
group by machine_id, process_id
```

<img width="291" height="136" alt="image" src="https://github.com/user-attachments/assets/13fd6c64-0168-499c-ad45-58f138b976d6" />

```
SELECT 
    machine_id,
    ROUND(AVG(end_time - start_time), 3) AS processing_time
FROM (
    SELECT 
        machine_id,
        process_id,
        MAX(CASE WHEN activity_type = 'end' THEN timestamp END) AS end_time,
        MAX(CASE WHEN activity_type = 'start' THEN timestamp END) AS start_time
    FROM Activity
    GROUP BY machine_id, process_id
) t
GROUP BY machine_id;
```

<img width="199" height="80" alt="image" src="https://github.com/user-attachments/assets/2d5264f2-d47c-426d-a4a0-3aae279fdee0" />


